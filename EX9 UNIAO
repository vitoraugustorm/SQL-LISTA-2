SELECT 
  PEDIDOS.CLIENTE_ID
, NOMES.NOME
, COUNT(FINANCEIRO.NOME_ID) AS TOTALPAGAMENTOS
, AVG(FINANCEIRO.DATA_BAIXA - FINANCEIRO.VENCIMENTO) AS MEDIADEDIASATRASO
FROM PEDIDOS
LEFT JOIN NOMES ON NOMES.NOME_ID = PEDIDOS.CLIENTE_ID
LEFT JOIN PEDIDOS_DETALHES ON PEDIDOS_DETALHES.PEDIDO_ID = PEDIDOS.PEDIDO_ID
LEFT JOIN FINANCEIRO ON FINANCEIRO.PEDIDO_ID = PEDIDOS.PEDIDO_ID
WHERE (FINANCEIRO.DATA_BAIXA BETWEEN '01.01.2021' AND '31.12.2021') AND (FINANCEIRO.DATA_BAIXA > FINANCEIRO.VENCIMENTO)
GROUP BY NOMES.NOME, PEDIDOS.CLIENTE_ID
ORDER BY COUNT(PEDIDOS.CLIENTE_ID) DESC
ROWS 10
