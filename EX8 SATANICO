SELECT 
  PEDIDOS.CLIENTE_ID
, NOMES.NOME
, SUM(PEDIDOS_DETALHES.VALOR_VENDA) AS VALORVENDASTOTAL
, COUNT(PEDIDOS.CLIENTE_ID) AS TOTALCOMPRAS
FROM PEDIDOS
LEFT JOIN NOMES ON NOMES.NOME_ID = PEDIDOS.CLIENTE_ID
LEFT JOIN PEDIDOS_DETALHES ON PEDIDOS_DETALHES.PEDIDO_ID = PEDIDOS.PEDIDO_ID
WHERE PEDIDOS.DATA_PEDIDO BETWEEN '01.01.2021' AND '31.12.2021'
GROUP BY NOMES.NOME, PEDIDOS.CLIENTE_ID
ORDER BY COUNT(PEDIDOS.CLIENTE_ID) DESC
ROWS 10
